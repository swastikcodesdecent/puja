<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Durga Puja Explorer</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>


    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff6b6b, #ffa500, #ff1744);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Preloader Styles */
        .preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #ff6b6b, #ffa500, #ff1744);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: all 0.8s ease;
        }

        .preloader.hidden {
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
        }

        .loader {
            width: 100px;
            height: 100px;
            border: 6px solid rgba(255, 255, 255, 0.3);
            border-top: 6px solid white;
            border-radius: 50%;
            animation: spin 1.2s linear infinite;
            margin-bottom: 30px;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .preloader h1 {
            color: white;
            font-size: 3rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            animation: glow 2s ease-in-out infinite alternate;
        }

        .preloader p {
            color: white;
            font-size: 1.3rem;
            opacity: 0.9;
            text-align: center;
        }

        @keyframes glow {
            from { text-shadow: 2px 2px 8px rgba(0,0,0,0.3), 0 0 20px rgba(255,255,255,0.3); }
            to { text-shadow: 2px 2px 8px rgba(0,0,0,0.3), 0 0 30px rgba(255,255,255,0.6); }
        }

        /* Login Page Styles */
        .login-container {
            display: none;
            min-height: 100vh;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 50px;
            border-radius: 25px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            text-align: center;
            max-width: 450px;
            width: 100%;
            transform: translateY(30px);
            opacity: 0;
            animation: slideUp 0.8s ease forwards;
            border: 1px solid rgba(255,255,255,0.2);
        }

        @keyframes slideUp {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .login-card h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 2.5rem;
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-card p {
            color: #666;
            margin-bottom: 35px;
            font-size: 1.2rem;
            line-height: 1.6;
        }

        .google-login-btn {
            background: linear-gradient(135deg, #4285f4, #357ae8);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(66, 133, 244, 0.3);
            position: relative;
            overflow: hidden;
        }

        .google-login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(66, 133, 244, 0.4);
        }

        .google-login-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .google-login-btn:hover:before {
            left: 100%;
        }

        /* Main App Styles */
        .main-app {
            display: none;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            padding: 20px 0;
            box-shadow: 0 5px 25px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .wallet {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 3px solid #ff6b6b;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .welcome-section {
            text-align: center;
            color: white;
            margin-bottom: 50px;
        }

        .welcome-section h1 {
            font-size: 3.5rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
        }

        .welcome-section p {
            font-size: 1.3rem;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .pandal-sections {
            display: grid;
            gap: 40px;
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #ff6b6b;
        }

        .section-title {
            font-size: 2rem;
            color: #333;
            margin-right: 15px;
        }

        .section-emoji {
            font-size: 2rem;
        }

        .pandal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .pandal-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .pandal-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            border-color: #ff6b6b;
        }

        .pandal-card.visited {
            background: linear-gradient(135deg, #e8f5e8, #f0fff0);
            border-color: #28a745;
        }

        .pandal-card.visited::after {
            content: '‚úì';
            position: absolute;
            top: 10px;
            right: 10px;
            background: #28a745;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .pandal-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .pandal-location {
            color: #666;
            font-size: 0.95rem;
            margin-bottom: 15px;
        }

        .pandal-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .visit-btn, .upload-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .visit-btn {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            color: white;
        }

        .visit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .visit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .upload-btn {
            background: #007bff;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .upload-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .upload-btn input {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        /* Photo Gallery */
        .photo-gallery {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .gallery-content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-gallery {
            float: right;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
        }

        .uploaded-photo {
            width: 100%;
            border-radius: 10px;
            margin: 10px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .welcome-section h1 {
                font-size: 2.5rem;
            }

            .preloader h1 {
                font-size: 2rem;
            }

            .pandal-grid {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: 1fr 1fr;
            }

            .login-card {
                padding: 30px 20px;
            }

            .login-card h2 {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px 10px;
            }

            .section {
                padding: 20px 15px;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .pandal-actions {
                flex-direction: column;
            }
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #dc3545;
        }

        /* Hamper Section */
        .hamper-section {
            background: linear-gradient(135deg, #ffd700, #ffed4a);
            color: #333;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin: 30px 0;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }

        .hamper-section h2 {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .hamper-section p {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .claim-hamper-btn {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .claim-hamper-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        .claim-hamper-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
    </style>
</head>
<body>
    <!-- Preloader -->
    <div class="preloader" id="preloader">
        <div class="loader"></div>
        <h1>üôè Durga Puja Explorer</h1>
        <p>Loading your spiritual journey...</p>
    </div>

    <!-- Login Container -->
    <div class="login-container" id="loginContainer">
        <div class="login-card">
            <h2>üôè Welcome</h2>
            <p>Join thousands of devotees exploring Durga Puja pandals across Kolkata. Sign in to start your journey and earn DurgaPoints!</p>
            <div id="g_id_onload"
     data-client_id="612652331545-0mf3qnqaie9hgtbmp47t66sjtjmprg01.apps.googleusercontent.com"
     data-callback="handleCredentialResponse"
     data-auto_prompt="false">
</div>
<div class="g_id_signin" 
     data-type="standard" 
     data-size="large" 
     data-theme="outline" 
     data-text="signin_with" 
     data-shape="pill" 
     data-logo_alignment="left">
</div>

        </div>
    </div>

    <!-- Main Application -->
    <div class="main-app" id="mainApp">
        <div class="header">
            <div class="header-content">
                <div class="logo">üôè Durga Puja Explorer</div>
                <div class="wallet" id="wallet">üí∞ 0 DurgaPoints</div>
                <div class="user-info">
                    <img class="user-avatar" id="userAvatar" src="" alt="User">
                    <span id="userName"></span>
                    <button class="logout-btn" onclick="signOut()">Logout</button>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="welcome-section">
                <h1>üéä Durga Puja 2024</h1>
                <p>Explore the magnificent pandals across Kolkata and collect DurgaPoints!</p>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <h3 id="totalPandals">82</h3>
                    <p>Total Pandals</p>
                </div>
                <div class="stat-card">
                    <h3 id="visitedCount">0</h3>
                    <p>Visited</p>
                </div>
                <div class="stat-card">
                    <h3 id="photosUploaded">0</h3>
                    <p>Photos Uploaded</p>
                </div>
                <div class="stat-card">
                    <h3 id="pointsEarned">10</h3>
                    <p>Points Earned</p>
                </div>
            </div>

            <!-- Hamper Section -->
            <div class="hamper-section">
                <h2>üéÅ Exclusive Hamper</h2>
                <p>Complete your Durga Puja journey and claim your exclusive hamper after the festivities end!</p>
                <button class="claim-hamper-btn" id="claimHamperBtn" onclick="claimHamper()" disabled>
                    üéÅ Claim Your Hamper
                </button>
            </div>

            <div class="pandal-sections">
                <!-- North Kolkata -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">North Kolkata</h2>
                        <span class="section-emoji">üèõÔ∏è</span>
                    </div>
                    <p style="color: #666; margin-bottom: 20px;">Traditional, heritage-rich, and theme-based pandals</p>
                    <div class="pandal-grid" id="northKolkata"></div>
                </div>

                <!-- South Kolkata -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">South Kolkata</h2>
                        <span class="section-emoji">‚ú®</span>
                    </div>
                    <p style="color: #666; margin-bottom: 20px;">Big-budget, glamorous, and highly creative pandals</p>
                    <div class="pandal-grid" id="southKolkata"></div>
                </div>

                <!-- East Kolkata -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">East Kolkata</h2>
                        <span class="section-emoji">üåÖ</span>
                    </div>
                    <p style="color: #666; margin-bottom: 20px;">Modern zones, Salt Lake & beyond</p>
                    <div class="pandal-grid" id="eastKolkata"></div>
                </div>

                <!-- Central Kolkata -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Central Kolkata</h2>
                        <span class="section-emoji">üèôÔ∏è</span>
                    </div>
                    <p style="color: #666; margin-bottom: 20px;">Mixed heritage & modern, around MG Road‚ÄîSealdah‚ÄîBowbazar</p>
                    <div class="pandal-grid" id="centralKolkata"></div>
                </div>

                <!-- West Kolkata -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">West Kolkata</h2>
                        <span class="section-emoji">üåÑ</span>
                    </div>
                    <p style="color: #666; margin-bottom: 20px;">Howrah side & western suburbs</p>
                    <div class="pandal-grid" id="westKolkata"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Photo Gallery Modal -->
    <div class="photo-gallery" id="photoGallery">
        <div class="gallery-content">
            <button class="close-gallery" onclick="closeGallery()">&times;</button>
            <h3 id="galleryTitle">Photos</h3>
            <div id="galleryPhotos"></div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
        // Sample user data structure
        let userData = {
            name: '',
            email: '',
            avatar: '',
            durgaPoints: 10,
            visitedPandals: new Set(),
            uploadedPhotos: {},
            isSignedIn: false
        };

        // Pandal data
        const pandalData = {
            north: [
                "Bagbazar Sarbojanin", "Kumartuli Park & Kumartuli Sarbojanin", "College Square",
                "Hatibagan Sarbojanin", "Ahiritola Sarbojanin", "Nalin Sarkar Street Sarbojanin",
                "Sovabazar Rajbari", "Pathuriaghata Khelat Ghosh Puja", "Tala Barowari Durgotsab",
                "Santosh Mitra Square", "Maniktala Chaltabagan Lohapatty", "Sealdah Railway Athletic Club",
                "Hedua / Azad Hind Bagh Sarbojanin", "Jagat Mukherjee Park", "Brindaban Matri Mandir"
            ],
            south: [
                "Ekdalia Evergreen Club", "Deshapriya Park", "Tridhara Sammilani", "Chetla Agrani Club",
                "Ballygunge Cultural Association", "Jodhpur Park", "Badamtala Ashar Sangha",
                "Suruchi Sangha", "Bhowanipore 75 Palli", "Singhi Park", "Mudiali Club",
                "Bosepukur Sitala Mandir", "Selimpur Pally", "Hindustan Park / Hindustan Club",
                "Rajdanga Naba Uday Sangha", "Chakraberia Sarbojanin", "Bakul Bagan Sarbojanin",
                "95 Palli", "Rashbehari / Shib Mandir", "Garfa Sarbojanin"
            ],
            east: [
                "Sreebhumi Sporting Club", "Lake Town Adhibasi Brinda", "Dum Dum Park Tarun Sangha",
                "Dum Dum Park Bharat Chakra", "Dum Dum Park Sarbojanin", "Telengabagan Sarbojanin",
                "Kankurgachi Yubak Brinda", "Ultadanga Pally Puja", "Salt Lake FD Block Puja",
                "Salt Lake BJ Block Puja", "Salt Lake AE Block Puja", "Salt Lake BB Block Puja",
                "Salt Lake Labony Estate Puja", "New Town AA Block Puja", "New Town CE Block Puja"
            ],
            central: [
                "Mohammad Ali Park", "Kashi Bose Lane", "Chaltabagan Durga Puja",
                "Taltala Ground Pally Mangal Samity"
            ],
            west: [
                "Howrah Kadamtala Puja", "Salkia Bantra Puja", "Shibpur Sarbojanin Puja",
                "Ramrajatala Puja", "Santragachi Puja", "Belur Math Puja"
            ]
        };

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Show preloader for 3 seconds
            setTimeout(() => {
                document.getElementById('preloader').classList.add('hidden');
                setTimeout(() => {
                    document.getElementById('preloader').style.display = 'none';
                    document.getElementById('loginContainer').style.display = 'flex';
                }, 800);
            }, 3000);

            // Load saved user data
            loadUserData();
        });

        // Google Sign In (Simulated)
        function signIn() {
            // Simulate Google login
            userData.name = 'Devotee ' + Math.floor(Math.random() * 1000);
            userData.email = 'devotee@gmail.com';
            userData.avatar = 'https://via.placeholder.com/45/ff6b6b/ffffff?text=' + userData.name.charAt(0);
            userData.isSignedIn = true;

            // If first time login, give 10 points
            if (userData.durgaPoints === 0) {
                userData.durgaPoints = 10;
            }

            showNotification('Welcome! You received 10 DurgaPoints! üéâ');
            
            // Hide login and show main app
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // Initialize the main app
            initializeApp();
            saveUserData();
        }

        // Sign Out
        function signOut() {
            userData.isSignedIn = false;
            saveUserData();
            location.reload();
        }

        // Initialize the main application
        function initializeApp() {
            // Update user info
            document.getElementById('userName').textContent = userData.name;
            document.getElementById('userAvatar').src = userData.avatar;
            updateWallet();
            updateStats();

            // Render pandals
            renderPandals();
        }

        // Update wallet display
        function updateWallet() {
            document.getElementById('wallet').textContent = `üí∞ ${userData.durgaPoints} DurgaPoints`;
        }

        // Update statistics
        function updateStats() {
            document.getElementById('visitedCount').textContent = userData.visitedPandals.size;
            document.getElementById('photosUploaded').textContent = Object.keys(userData.uploadedPhotos).length;
            document.getElementById('pointsEarned').textContent = userData.durgaPoints;
            
            // Check if eligible for hamper (visited at least 10 pandals)
            if (userData.visitedPandals.size >= 10) {
                document.getElementById('claimHamperBtn').disabled = false;
                document.getElementById('claimHamperBtn').textContent = 'üéÅ Claim Your Hamper (Eligible!)';
            }
        }

        // Render pandals in their respective sections
        function renderPandals() {
            const sections = ['north', 'south', 'east', 'central', 'west'];
            const containerIds = ['northKolkata', 'southKolkata', 'eastKolkata', 'centralKolkata', 'westKolkata'];

            sections.forEach((section, index) => {
                const container = document.getElementById(containerIds[index]);
                container.innerHTML = '';

                pandalData[section].forEach((pandal, pandalIndex) => {
                    const pandalId = `${section}-${pandalIndex}`;
                    const isVisited = userData.visitedPandals.has(pandalId);
                    const hasPhotos = userData.uploadedPhotos[pandalId];

                    const pandalCard = document.createElement('div');
                    pandalCard.className = `pandal-card ${isVisited ? 'visited' : ''}`;
                    pandalCard.innerHTML = `
                        <div class="pandal-name">${pandal}</div>
                        <div class="pandal-location">${section.charAt(0).toUpperCase() + section.slice(1)} Kolkata</div>
                        <div class="pandal-actions">
                            <button class="visit-btn" onclick="visitPandal('${pandalId}')" ${isVisited ? 'disabled' : ''}>
                                ${isVisited ? '‚úÖ Visited' : 'üìç Mark as Visited'}
                            </button>
                            <button class="upload-btn">
                                üì∏ Upload Photo
                                <input type="file" accept="image/*" onchange="uploadPhoto('${pandalId}', this)" multiple>
                            </button>
                            ${hasPhotos ? `<button class="upload-btn" onclick="viewPhotos('${pandalId}')">üëÄ View Photos (${hasPhotos.length})</button>` : ''}
                        </div>
                    `;
                    container.appendChild(pandalCard);
                });
            });
        }

        // Visit a pandal
        function visitPandal(pandalId) {
            if (!userData.visitedPandals.has(pandalId)) {
                userData.visitedPandals.add(pandalId);
                userData.durgaPoints += 0; // No points for just visiting, only for photos
                
                showNotification('Pandal visited! Upload photos to earn 5 DurgaPoints! üì∏');
                updateWallet();
                updateStats();
                renderPandals();
                saveUserData();
            }
        }

        // Upload photo
        function uploadPhoto(pandalId, input) {
            if (input.files.length > 0) {
                if (!userData.uploadedPhotos[pandalId]) {
                    userData.uploadedPhotos[pandalId] = [];
                }

                Array.from(input.files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        userData.uploadedPhotos[pandalId].push({
                            src: e.target.result,
                            name: file.name,
                            date: new Date().toLocaleDateString()
                        });
                        
                        // Award points for photo upload
                        userData.durgaPoints += 5;
                        showNotification(`Photo uploaded! +5 DurgaPoints earned! üéâ`);
                        
                        updateWallet();
                        updateStats();
                        renderPandals();
                        saveUserData();
                    };
                    reader.readAsDataURL(file);
                });
            }
            input.value = ''; // Clear the input
        }

        // View uploaded photos
        function viewPhotos(pandalId) {
            const photos = userData.uploadedPhotos[pandalId];
            if (!photos) return;

            const gallery = document.getElementById('photoGallery');
            const galleryPhotos = document.getElementById('galleryPhotos');
            const galleryTitle = document.getElementById('galleryTitle');

            // Get pandal name
            const [section, index] = pandalId.split('-');
            const pandalName = pandalData[section][parseInt(index)];
            galleryTitle.textContent = `Photos from ${pandalName}`;

            galleryPhotos.innerHTML = '';
            photos.forEach(photo => {
                const photoDiv = document.createElement('div');
                photoDiv.innerHTML = `
                    <img src="${photo.src}" alt="${photo.name}" class="uploaded-photo">
                    <p style="text-align: center; color: #666; margin-top: 5px;">
                        ${photo.name} - ${photo.date}
                    </p>
                `;
                galleryPhotos.appendChild(photoDiv);
            });

            gallery.style.display = 'flex';
        }

        // Close photo gallery
        function closeGallery() {
            document.getElementById('photoGallery').style.display = 'none';
        }

        // Claim hamper
        function claimHamper() {
            if (userData.visitedPandals.size >= 10) {
                showNotification('üéâ Congratulations! Your hamper has been claimed! It will be delivered soon!', 'success');
                document.getElementById('claimHamperBtn').textContent = '‚úÖ Hamper Claimed!';
                document.getElementById('claimHamperBtn').disabled = true;
                
                // Award bonus points
                userData.durgaPoints += 50;
                showNotification('Bonus: +50 DurgaPoints for completing your journey! üèÜ');
                updateWallet();
                saveUserData();
            }
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type === 'error' ? 'error' : ''}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Save user data to localStorage simulation
        function saveUserData() {
            // Convert Set to Array for storage
            const dataToSave = {
                ...userData,
                visitedPandals: Array.from(userData.visitedPandals)
            };
            // In a real app, this would be saved to localStorage or a database
            // localStorage.setItem('durgaPujaUserData', JSON.stringify(dataToSave));
        }

        // Load user data from localStorage simulation
        function loadUserData() {
            // In a real app, this would load from localStorage or a database
            // const savedData = localStorage.getItem('durgaPujaUserData');
            // if (savedData) {
            //     const parsedData = JSON.parse(savedData);
            //     userData = {
            //         ...parsedData,
            //         visitedPandals: new Set(parsedData.visitedPandals)
            //     };
            // }
        }

        // Close gallery when clicking outside
        document.getElementById('photoGallery').addEventListener('click', function(e) {
            if (e.target === this) {
                closeGallery();
            }
        });

        // Handle escape key for gallery
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeGallery();
            }
        });

        // Add some sample demo functionality for better UX
        function demoMode() {
            // Add some sample visits and photos for demo
            setTimeout(() => {
                if (userData.visitedPandals.size === 0) {
                    showNotification('üëã Welcome! Try visiting some pandals and uploading photos to earn points!');
                }
            }, 5000);
        }

        // Initialize demo mode after app loads
        setTimeout(demoMode, 1000);

        // Simulate festival end date check
        function checkFestivalStatus() {
            const now = new Date();
            const festivalEnd = new Date('2024-10-15'); // Adjust date as needed
            
            if (now > festivalEnd && userData.visitedPandals.size >= 5) {
                document.getElementById('claimHamperBtn').style.display = 'block';
                showNotification('üéä Durga Puja festivities have ended! You can now claim your hamper!');
            }
        }

        // Add smooth scrolling for better UX
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        // Add loading states for better UX
        function showLoading(button) {
            button.disabled = true;
            button.innerHTML = '‚è≥ Processing...';
        }

        function hideLoading(button, originalText) {
            button.disabled = false;
            button.innerHTML = originalText;
        }

        // Enhanced photo upload with preview
        function enhancedUploadPhoto(pandalId, input) {
            if (input.files.length > 0) {
                const button = input.parentElement;
                const originalText = button.innerHTML;
                showLoading(button);

                // Simulate upload delay for better UX
                setTimeout(() => {
                    uploadPhoto(pandalId, input);
                    hideLoading(button, originalText);
                }, 1000);
            }
        }

        // Add progress tracking
        function getProgress() {
            const totalPandals = Object.values(pandalData).flat().length;
            const visitedCount = userData.visitedPandals.size;
            return Math.round((visitedCount / totalPandals) * 100);
        }

        // Update progress display
        function updateProgress() {
            const progress = getProgress();
            const progressElement = document.getElementById('progress');
            if (progressElement) {
                progressElement.style.width = `${progress}%`;
                progressElement.textContent = `${progress}% Complete`;
            }
        }
        function handleCredentialResponse(response) {
    const data = jwt_decode(response.credential); // You need jwt-decode library
    userData.name = data.name;
    userData.email = data.email;
    userData.avatar = data.picture;
    userData.isSignedIn = true;

    showNotification('Welcome! You received 10 DurgaPoints! üéâ');

    document.getElementById('loginContainer').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';

    initializeApp();
    saveUserData();
}
function signOut() {
    google.accounts.id.disableAutoSelect();
    userData.isSignedIn = false;
    saveUserData();
    location.reload();
}


    </script>
</body>
</html>
